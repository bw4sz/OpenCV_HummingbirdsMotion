<?xml version="1.0" encoding="utf-8"?>
<module name="MotionMeerkat" type="runtime">

    <!-- Comments are OK -->  
    <tag name="inputs">
        <tag name="image_url" type="resource">
            <template>
                <tag name="accepted_type" value="image" />
                <tag name="accepted_type" value="dataset" />
                <tag name="label" value="Video file to detect motion" />
                <tag name="prohibit_upload" value="true" type="boolean" />
            </template>
        </tag> 
                        
        <tag name="mex_url"  type="system-input" />
        <tag name="bisque_token"  type="system-input" />
		<tag name="accAvg" value="0.35" type="number">
			<template>
			<tag name="label" value="Sensitivity to motion"/>
			<tag name="allowNone" value="true" type="boolean"/>
			<tag name="description" value="The sensitivity to motion controls the accumulated weighted average of the previous frames using the OpenCV::cv2.accumlateWeighted function. For each pixel (x,y) in a frame, this function calculates the weighted averages of the current frame (src) with the previous frames, and returns a running average of the frame sequence (dst). Higher values make the algorithm less sensitive to motion "/>
			</template>
		</tag>
		<tag name="fileD" type="string">
			<template>
			<tag name="label" value="Output folder name"/>
			<tag name="description" value="The name of the folder of candidate motion frames returned by MotionMeerkat"/>
			</template>
		</tag>
		<tag name="plotwatcher" value="false" type="boolean" >
	            <template>
	                <tag name="label" value="Does this video come from a plotwatcher camera (True/False)" />
	            </template>           
	    </tag>
		<tag name="adapt" value="true" type="boolean" >
	            <template>
	                <tag name="label" value="Adaptive averaging of the motion sensitivity?" />
	            </template>           
	    </tag>

		<tag name="frameHIT" value="0.01" type="number">
			<template>
			<tag name="label" value="Expected frames with motion"/>
			<tag name="allowNone" value="true" type="boolean"/>
			<tag name="description" value="An optional adaptive accAVG setting which attenuates the sensitivity during the video run based on a user specified hit rate. Every ten minutes, the algorithm evaluates the number of photos returned in a ten minute window, and increase the sensitivity if the value was less than the expected hit rate, or decrease the value if it was greater than the expected hit rate."/>
			</template>
		</tag>
		<tag name="floorvalue" value="0.05" type="number">
			<template>
			<tag name="label" value="Minimum sensitivity"/>
			<tag name="allowNone" value="true" type="boolean"/>
			<tag name="description" value="Used in conjunction with the adaptive accAVG, this value provides a minimum sensitivity, which is critical for videos with little background motion."/>
			</template>
		</tag>	
    </tag>
    
    <tag name="outputs">
         <tag name="Motion" type="tag">
            <template>
                <tag name="label" value="Candidate motion frames" />
            </template>             
         </tag>   
    </tag>
  
    <tag name="module_options" >
        <tag name="version" value="3" />
    </tag>
    
    <tag name="display_options" >
       <tag name="group" value="Examples" />
    </tag>
    
    <tag name="help" type="file" value="public/help.html" /> 
    <tag name="thumbnail" type="file" value="public/thumbnail.png" />   

    <tag name="title" type="string" value="Motion Detection" /> 
    <tag name="authors" type="string" value="Ben Weinstein - Stony Brook University" /> 
    <tag name="description" type="string" value="This module extracts potential motion events from video files" />
    <tag name="citation" type="string" value="Please cite this resource as XXX" /> 
	
	<tag name="execute_options">
		<tag name="argument_style" value="positional"/>
		<tag name="iterable" value="resource_url" type="dataset"/>
	</tag>
</module>
